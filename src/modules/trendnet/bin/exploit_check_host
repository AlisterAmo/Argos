#!/usr/bin/python2.6
import re,socket,sys

def checkCam( ip, puerto ):
	# print ('Comprobando ' + ip + ':' + str(puerto) )	
	try:
		sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
		sock.settimeout(1.5)
		# print ('DEBUG: valor de puerto = ' + puerto) 		
 		try:
			sock.connect((ip, puerto))
		except Exception, e:
    			print(e)
		# print ('DEBUG: errno:' + errno)
		sock.send('GET /anony/mjpg.cgi HTTP/1.0\r\n\r\n')
		res = sock.recv(100)
		if(res.find('200 OK') > 0):
			return True
		return False
	except:
		return False


try:
		#check the matches to see if they fit what we are looking for
			ip = sys.argv[1]
			try:
    				puerto = int(sys.argv[2])
			except ValueError:
    				puerto = 80					
			if(checkCam(ip, puerto)):
				# print ('http://' + ip + ':' + str(puerto) + '/anony/mjpg.cgi') 
				exit(0)				
				#outfile.write(f)
                                #outfile.flush()	
			else:
				exit(1)
except():
	exit(1)
	

